`性能优化`

## OOM产生的原因？

已使用内存 + 新申请内存 > 可分配内存

## 如何避免OOM产生？
减少内存的占用（参考 5R 法则）

## 有哪些节约内存的细节？

#### 1. 使用合适的数据结构
例如用 ArrayMap/SparseArray 代替 HashMap，用 ArraySet 代替 HashSet
ArrayMap：查询 O(logN)，插入 O(logN)，1.5 倍扩容，0.5 倍缩容，无额外对象开销，小数组复用池
HashMap：查询接近 O(1)，插入接近 O(1)，2 倍扩容，无缩容机制，额外的 Entry 开销

#### 2. 避免使用枚举
枚举：24 字节，整形：4 字节

#### 3. Bitmap 的使用
1. 选择合适的分辨率
2. 注意原始文件分辨率和内存缩放的结果
3. 不使用帧动画，用代码实现动效
4. 考虑对Bitmap的重采样和复用配置

#### 4. 谨慎的使用多进程

#### 5. 谨慎的使用 Large Heap

#### 6. 使用 NDK
Native Heap 没有专门的限制，内存大户核心逻辑放在 Native 层，例如游戏框架、OpenGL、地图


## 内存优化的5R法则

1. Reduce 缩减：降低图片分辨率/重采样/抽稀策略

2. Reuse 复用：池化策略/避免频繁创建对象，减小 GC 压力

3. Recycle 回收：主动销毁、结束，避免内存泄漏/生命周期闭环

4. Refactor 重构：使用更合适的数据结构/更合理的程序架构

5. Revalue 重审：谨慎使用 Large Heap/多进程/第三方框架

## 链接
[慕课网：如何避免OOM的产生？](https://coding.imooc.com/lesson/317.html#mid=22314)